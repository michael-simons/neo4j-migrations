<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="Michael Simons">
<title>Neo4j-Migrations</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Neo4j-Migrations</h1>
<div class="details">
<span id="author" class="author">Michael Simons</span><br>
<span id="email" class="email"><a href="mailto:michael.simons@neo4j.com">michael.simons@neo4j.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#introduction-about">1.1. About</a></li>
<li><a href="#introduction-compatibility">1.2. Compatibility</a></li>
<li><a href="#introduction-versions">1.3. Versions</a></li>
<li><a href="#introduction-modules">1.4. Modules</a></li>
<li><a href="#introduction-changelog">1.5. Changelog</a></li>
<li><a href="#introduction-history">1.6. History</a></li>
</ul>
</li>
<li><a href="#download">2. Download</a>
<ul class="sectlevel2">
<li><a href="#download_cli">2.1. CLI</a></li>
<li><a href="#download_core">2.2. Core API</a></li>
<li><a href="#download_springboot">2.3. Spring-Boot-Starter</a></li>
<li><a href="#download_quarkus">2.4. Quarkus</a></li>
<li><a href="#maven-plugin">2.5. Maven-Plugin</a></li>
</ul>
</li>
<li><a href="#concepts">3. Concepts</a>
<ul class="sectlevel2">
<li><a href="#concepts_connectivity">3.1. Connectivity</a></li>
<li><a href="#concepts_migrations">3.2. Migrations</a></li>
<li><a href="#concepts_callbacks">3.3. Callbacks</a></li>
<li><a href="#concepts_naming-conventions">3.4. Naming conventions</a></li>
<li><a href="#concepts_chain">3.5. Chain of applied migrations</a></li>
<li><a href="#concepts_separate-databases">3.6. Separate schema databases</a></li>
<li><a href="#concepts_transactions">3.7. Transactions</a></li>
</ul>
</li>
<li><a href="#usage">4. Usage</a>
<ul class="sectlevel2">
<li><a href="#usage_common">4.1. Common operations</a></li>
<li><a href="#cli">4.2. CLI</a></li>
<li><a href="#coreapi">4.3. Core API</a></li>
<li><a href="#usage_spring-boot-starter">4.4. Spring-Boot-Starter</a></li>
<li><a href="#usage_quarkus">4.5. Quarkus</a></li>
<li><a href="#usage_maven-plugin">4.6. Maven-Plugin</a></li>
</ul>
</li>
<li><a href="#appendix">Appendix</a>
<ul class="sectlevel2">
<li><a href="#glossary">Glossary</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; Copyright 2020-2022 the original author or authors.</p>
</div>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>This is the Neo4j-Migrations manual version 1.4.0-SNAPSHOT.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-about"><a class="anchor" href="#introduction-about"></a>1.1. About</h3>
<div class="paragraph">
<p>Neo4j-Migrations are a set of tools to make your schema migrations as easy as possible.
They provide a uniform way for applications, the command line and build tools alike to track, manage and apply changes to your database, in short: to refactor your database.
The project is inspired to a large extend by <a href="https://flywaydb.org">FlywayDB</a>, which is an awesome tool for migration of relational databases.
Most things evolve around Cypher scripts, however the Core API of Neo4j-Migrations allows defining Java classes as migrations as well.</p>
</div>
<div class="paragraph">
<p>Neo4j-Migrations builds directly on top of the official <a href="https://github.com/neo4j/neo4j-java-driver">Neo4j Java driver</a>, supports Neo4j from 3.5 up to 4.4, including enterprise features such as multidatabase support and impersonation.
The only dependencies are said driver and <a href="https://github.com/classgraph/classgraph">ClassGraph</a>, the latter being used to find migrations on the classpath.</p>
</div>
<div class="paragraph">
<p>The history of migrations applied is stored as a subgraph in your database.</p>
</div>
</div>
<div class="sect2">
<h3 id="introduction-compatibility"><a class="anchor" href="#introduction-compatibility"></a>1.2. Compatibility</h3>
<div class="paragraph">
<p>Neo4j-Migrations is tested only against <a href="https://neo4j.com">Neo4j</a>, the world&#8217;s leading Graph database.
Neo4j-Migrations requires a 4.x version of Neo4j Java Driver.
The project is build and tested with the latest 4.4 version, however previous versions 4.3, 4.2 and 4.1 are supported as well and can be used as drop-in-replacement.
Therefore, Neo4j-Migrations works with Neo4j 3.5, 4.0 - 4.4 and of course, Neo4j-Aura.
It also can be used with an embedded instance, as long as the embedded instances provides the Bolt-Connector, too.
The tooling may or may not work with other databases using the Bolt protocol. We don&#8217;t provide any support for those.</p>
</div>
<div class="paragraph">
<p>The Core API and the JVM based version of the CLI module of Neo4j-Migrations requires at least Java 8 to run.
Native binaries are provided for 64bit versions of macOS, Linux and Windows. The native binaries don&#8217;t require a JVM to be installed.</p>
</div>
<div class="paragraph">
<p>All releases of Neo4j-Migrations are compiled with JDK 17 while targeting JDK 8. Thus, we ensure both source, target and API compatibility with JDK 8.
In addition, the Core API is provided as a Multi-Release-Jar, providing a <code>module-info.java</code> for JDK 11 and higher, making it a good citizen on the Java module path.</p>
</div>
<div class="paragraph">
<p>For JDK 17 and higher we do restrict the usage of some interfaces and have better boundaries for you what you can safely implement and what you should not.</p>
</div>
</div>
<div class="sect2">
<h3 id="introduction-versions"><a class="anchor" href="#introduction-versions"></a>1.3. Versions</h3>
<div class="paragraph">
<p>Neo4j-Migrations 1.0.0 has been considered stable and has been released in November 2021. Since then, we ensure <a href="https://semver.org">semantic versioning</a>.
This means in cases where you use the Java API directly, you can be sure that patch releases won&#8217;t break your application, and you can always upgrade.</p>
</div>
</div>
<div class="sect2">
<h3 id="introduction-modules"><a class="anchor" href="#introduction-modules"></a>1.4. Modules</h3>
<div class="paragraph">
<p>Neo4j-Migrations comes in different flavors:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Core</dt>
<dd>
<p>The core module, providing an API to run both Cypher script and Java-based migrations.
The API includes builders for configuration.
The core is released as a Multi-Release-Jar, so that it behaves nicely on the module-path on JDK 17.
Be aware that we sealed all interfaces not intended to be implemented by you when running on JDK 17.</p>
<div class="paragraph">
<p><a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations/apidocs/index.html">JavaDoc</a> and <a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations/index.html">Project info</a></p>
</div>
</dd>
<dt class="hdlist1">CLI</dt>
<dd>
<p>A command line tool that supports every interaction that the core module provides.
Native binaries are available for Linux, macOS and Windows.
If you want to use Java-based migrations in the CLI, you must use the JVM distribution.
This is an ideal tool to be put into CI/CD not based on Maven or Gradle.</p>
</dd>
<dt class="hdlist1">Spring-Boot-Starter</dt>
<dd>
<p>Provides all configuration options via the well-known Spring-Boot-Properties mechanism and turns them
into a fully configured Migrations instance that will be applied on application start.
Scripts will be searched sane default location.</p>
<div class="paragraph">
<p><a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations-spring-boot-starter-parent/neo4j-migrations-spring-boot-autoconfigure/apidocs/index.html">JavaDoc</a> and <a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations-spring-boot-starter-parent/index.html">Project info</a></p>
</div>
</dd>
<dt class="hdlist1">Quarkus</dt>
<dd>
<p>An extension for Quarkus, providing full integration of all configuration option via Quarkus' configuration.
Creates a startup observer that applies all resolved migrations at startup.</p>
<div class="paragraph">
<p><a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations-quarkus-parent/neo4j-migrations-quarkus/apidocs/ac/simons/neo4j/migrations/quarkus/runtime/package-summary.html">JavaDoc</a> and <a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations-quarkus-parent/index.html">Project info</a></p>
</div>
</dd>
<dt class="hdlist1">Maven-Plugin</dt>
<dd>
<p>A Maven-plugin that hooks clean, apply and verify operations into the appropriate Maven lifecycles.
Use this to apply migrations during your build.</p>
<div class="paragraph">
<p><a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations-maven-plugin/plugin-info.html">Plugin info</a></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="introduction-changelog"><a class="anchor" href="#introduction-changelog"></a>1.5. Changelog</h3>
<div class="paragraph">
<p>We provide a full changelog on GitHub: <a href="https://github.com/michael-simons/neo4j-migrations/releases">Neo4j-Migrations</a>.
Our commits follow <a href="https://www.conventionalcommits.org/en/v1.0.0/">conventional commits</a>.
The releases are created and published via <a href="https://jreleaser.org">JReleaser</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="introduction-history"><a class="anchor" href="#introduction-history"></a>1.6. History</h3>
<div class="paragraph">
<p>The original idea of Neo4j-Migrations was conceived when working on integrating <a href="https://github.com/spring-projects/spring-data-neo4j">Spring Data Neo4j</a> (back then SDN/RX) into <a href="https://www.jhipster.tech">JHipster</a>.
We needed some Nodes, constraints and relationship to be present in the Neo4j database
for JHipster to do it&#8217;s magic but back then there was no lightweight (in terms of dependencies) tool that did work well with
Neo4j 4.0 (the first Graph database providing reactive data access out of the box).
Neo4j-Migrations filled that gap in early 2020 and has grown ever since.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="download"><a class="anchor" href="#download"></a>2. Download</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="download_cli"><a class="anchor" href="#download_cli"></a>2.1. CLI</h3>
<div class="sect3">
<h4 id="download_cli_brew"><a class="anchor" href="#download_cli_brew"></a>2.1.1. For homebrew users on macOS</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">brew install michael-simons/homebrew-neo4j-migrations/neo4j-migrations</code></pre>
</div>
</div>
<div class="paragraph">
<p>Autocompletion is automatically installed and available for bash and zsh when you configured Homebrew <a href="https://docs.brew.sh/Shell-Completion">accordingly</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="linux"><a class="anchor" href="#linux"></a>2.1.2. Linux</h4>
<div class="paragraph">
<p>As download from our <a href="https://github.com/michael-simons/neo4j-migrations/releases">release page</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">curl -LO https://github.com/michael-simons/neo4j-migrations/releases/download/1.4.0-SNAPSHOT/neo4j-migrations-1.4.0-SNAPSHOT-linux-x86_64.zip</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="windows"><a class="anchor" href="#windows"></a>2.1.3. Windows</h4>
<div class="paragraph">
<p>As download from our <a href="https://github.com/michael-simons/neo4j-migrations/releases">release page</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">curl -LO https://github.com/michael-simons/neo4j-migrations/releases/download/1.4.0-SNAPSHOT/neo4j-migrations-1.4.0-SNAPSHOT-windows-x86_64.zip</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="architectureindependent"><a class="anchor" href="#architectureindependent"></a>2.1.4. Architecture independent</h4>
<div class="paragraph">
<p>In addition to the above native binaries we still offer a JVM, architecture independent version of Neo4j-Migrations-CLI.
Only the JVM version does support custom, Java-based migrations as shown via the argument <code>--package</code>, the natively compiled versions do not.
Get this version here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">curl -LO https://github.com/michael-simons/neo4j-migrations/releases/download/1.4.0-SNAPSHOT/neo4j-migrations-1.4.0-SNAPSHOT.zip</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The architecture independent version can be used via Neo4js official <a href="https://www.jbang.dev">JBang</a> catalog:
    <br>
     With JBang installed, run <code>jbang neo4j-migrations@neo4j --help</code> for printing our usage information.
    <br>
     The catalog offers a couple of other scripts as well, check them out with <code>jbang catalog list neo4j</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="download_core"><a class="anchor" href="#download_core"></a>2.2. Core API</h3>
<div class="paragraph">
<p>The easiest way to get the Core API is to use a build- and dependency-management tool like Maven or Gradle.
Here are the coordinates:</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. Core API as Maven dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>eu.michael-simons.neo4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>neo4j-migrations<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.4.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or in case you fancy Gradle:</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Core API as Gradle dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">dependencies {
    implementation 'eu.michael-simons.neo4j:neo4j-migrations:1.4.0-SNAPSHOT'
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="download_springboot"><a class="anchor" href="#download_springboot"></a>2.3. Spring-Boot-Starter</h3>
<div class="paragraph">
<p>Use your dependency management to include the <a href="https://start.spring.io">Spring-Boot</a>-Starter.
The starter automatically triggers the dependency to the Neo4j-Java-Driver, which than can be configured via properties in the <code>spring.neo4j.*</code> namespace.
This starter here has a custom namespace, please refer to <a href="#usage_spring-boot-starter">Section 4.4</a> for more information.</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. Neo4j-Migrations-Spring-Boot-Starter as Maven dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>eu.michael-simons.neo4j<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>neo4j-migrations-spring-boot-starter<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>1.4.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or in case you fancy Gradle:</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. Neo4j-Migrations-Spring-Boot-Starter as Gradle dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">dependencies {
    implementation 'eu.michael-simons.neo4j:neo4j-migrations-spring-boot-starter:1.4.0-SNAPSHOT'
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="download_quarkus"><a class="anchor" href="#download_quarkus"></a>2.4. Quarkus</h3>
<div class="paragraph">
<p>Use your dependency management to include the <a href="https://quarkus.io">Quarkus</a> extension.
This extension automatically triggers the dependency to the Neo4j extension containing the Neo4j-Java-Driver.
The latter can be configured via properties in the <code>quarkus.neo4j.*</code> namespace.
The namespace for this extension is also <code>org.neo4j.migrations.*</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Neo4j-Migrations for Quarkus as Maven dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>eu.michael-simons.neo4j<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>neo4j-migrations-quarkus<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>1.4.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="maven-plugin"><a class="anchor" href="#maven-plugin"></a>2.5. Maven-Plugin</h3>
<div class="paragraph">
<p>Include the Maven-Plugin like this in your build and configure it according to <a href="#usage_maven-plugin">Section 4.6</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugins&gt;</span>
    <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>eu.michael-simons.neo4j<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>neo4j-migrations-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>1.4.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;configuration&gt;</span>
            <span class="tag">&lt;user&gt;</span>neo4j<span class="tag">&lt;/user&gt;</span>
            <span class="tag">&lt;password&gt;</span>secret<span class="tag">&lt;/password&gt;</span>
            <span class="tag">&lt;address&gt;</span>bolt://localhost:${it-database-port}<span class="tag">&lt;/address&gt;</span>
            <span class="tag">&lt;verbose&gt;</span>true<span class="tag">&lt;/verbose&gt;</span>
        <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;executions&gt;</span>
            <span class="tag">&lt;execution&gt;</span>
                <span class="tag">&lt;id&gt;</span>migrate<span class="tag">&lt;/id&gt;</span>
                <span class="tag">&lt;goals&gt;</span>
                    <span class="tag">&lt;goal&gt;</span>migrate<span class="tag">&lt;/goal&gt;</span>
                <span class="tag">&lt;/goals&gt;</span>
            <span class="tag">&lt;/execution&gt;</span>
            <span class="tag">&lt;execution&gt;</span>
                <span class="tag">&lt;id&gt;</span>default-validate<span class="tag">&lt;/id&gt;</span>
                <span class="tag">&lt;goals&gt;</span>
                    <span class="tag">&lt;goal&gt;</span>validate<span class="tag">&lt;/goal&gt;</span>
                <span class="tag">&lt;/goals&gt;</span>
            <span class="tag">&lt;/execution&gt;</span>
        <span class="tag">&lt;/executions&gt;</span>
    <span class="tag">&lt;/plugin&gt;</span>
<span class="tag">&lt;/plugins&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="concepts"><a class="anchor" href="#concepts"></a>3. Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter deals with various concepts that are applicable for all modules offered.
Especially checkout <a href="#concepts_naming-conventions">Section 3.4</a> regarding naming conventions, for all Cypher and Java-based migrations and callbacks.</p>
</div>
<div class="sect2">
<h3 id="concepts_connectivity"><a class="anchor" href="#concepts_connectivity"></a>3.1. Connectivity</h3>
<div class="paragraph">
<p>Neo4j-Migrations solely uses the <a href="https://github.com/neo4j/neo4j-java-driver">Neo4j Java Driver</a>.
Most of the time you pass a pre-configured driver object to our API.
The Spring-Boot-Plugin depends on the driver-instance provided by Spring-Boot which can be configured via properties in the <code>spring.neo4j.*</code> space.
The CLI and Maven-Plugin offer parameters to define the URL, username and password alike.</p>
</div>
<div class="paragraph">
<p>All of this mean that we can keep this chapter short and basically defer to the driver&#8217;s documentation:
<a href="https://neo4j.com/docs/java-manual/current/">The Neo4j Java Driver Manual v4.4</a>.
For ease of use, here are the most common forms of URLs the driver might take.
The URLS all have this format: <code>&lt;NEO4J_PROTOCOL&gt;://&lt;HOST&gt;:&lt;PORT&gt;</code>.
The Neo4j-Protocol might be one of the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 72.7273%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">URI scheme</th>
<th class="tableblock halign-left valign-top">Routing</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neo4j</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Yes</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unsecured</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neo4j+s</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Yes</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Secured with full certificate</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neo4j+ssc</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Yes</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Secured with self-signed certificate</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bolt</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unsecured</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bolt+s</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Secured with full certificate</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bolt+ssc</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Secured with self-signed certificate</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You don&#8217;t have to care much more about the Driver API than knowing how to create an instance:</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. Create an instance of the Neo4j-Java-Driver</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.neo4j.driver.AuthTokens</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.Config</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.Driver</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.GraphDatabase</span>;

<span class="type">class</span> <span class="class">HowToCreateADriverInstance</span> {

        <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span>... args) {
                <span class="predefined-type">Driver</span> driver = GraphDatabase.driver(
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j://your.database.io</span><span class="delimiter">&quot;</span></span>,
                        AuthTokens.basic(<span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>),
                        Config.defaultConfig()
                );
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This instance needs to be passed than to the Neo4j-Migrations Core API in case you aren&#8217;t using one of our integrations.
Mostly everything else than can be done via Cypher scripts alone.
If you need more control about what happens in a migration, have a look at our Java-based migration support in <a href="#concepts_migrations_java-based">Section 3.2.2</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="concepts_migrations"><a class="anchor" href="#concepts_migrations"></a>3.2. Migrations</h3>
<div class="paragraph">
<p>Migrations are all operations or refactorings you apply to a database.
These operations might be creating, changing, or dropping indexes and constraints or altering data.
Sometimes you might even want to create users or databases.</p>
</div>
<div class="sect3">
<h4 id="concepts_migrations_cypher-based"><a class="anchor" href="#concepts_migrations_cypher-based"></a>3.2.1. Cypher-based</h4>
<div class="paragraph">
<p>Cypher-based migrations can be mostly anything you can write down as <a href="https://neo4j.com/docs/cypher-refcard/current/">Cypher statement</a>.
A Cypher-based migration can contain one or more statements with multiple lines separated by a <code>;</code> followed by a new line.
By default, all statements in one script will be executed in a single transaction.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. neo4j/migrations/V007__BondTheNameIsBond.cypher</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">CREATE (agent:`007`) RETURN agent;
UNWIND RANGE(1,6) AS i
WITH i CREATE (n:OtherAgents {idx: '00' + i})
RETURN n
;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This script contains two different statements.</p>
</div>
<div class="paragraph">
<p>Neo4j-Migrations will by default look in <code>classpath:neo4j/migrations</code> for all <code>*.cypher</code> files matching the name described in
<a href="#concepts_naming-conventions">Section 3.4</a>. You can change (or add to this default) with the Core API or the appropriate properties in
Spring-Boot-Starter or the Maven-Plugin like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 8. Changing the locations to scan for Migrations (and Callbacks) via the Core API</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MigrationsConfig configLookingAtDifferentPlaces = MigrationsConfig.builder()
    .withLocationsToScan(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:my/awesome/migrations</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">file:/path/to/migration</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
    ).build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Look at a different place on the classpath</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Look additional at the given filesystem path</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="switchingdatabaseinsidecypherscripts"><a class="anchor" href="#switchingdatabaseinsidecypherscripts"></a>Switching database inside Cypher scripts</h5>
<div class="paragraph">
<p>It is of course possible to use the Cypher keyword <code>USE &lt;graph&gt;</code> (See <a href="https://neo4j.com/docs/cypher-manual/current/clauses/use/">USE</a>) inside your scripts.
There a couple of thinks to remember, though:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It can get tricky if you combine it in creative ways with the options for schema- and target-databases Neo4j-Migrations offer itself</p>
</li>
<li>
<p>If you have more than one statement per script (which is completely not a problem) and one of them should use <code>USE</code> you must
configure Neo4j-Migrations to use <code>TransactionMode#PER_STATEMENT</code> (see <a href="#concepts_transactions">Section 3.7</a>, meaning to run each statement of a script in a separate transaction.
This is slightly more error-prone, as it will most likely leave your database in an inconsistent state if one statement fails, since everything
before has already been committed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="concepts_migrations_java-based"><a class="anchor" href="#concepts_migrations_java-based"></a>3.2.2. Java-based</h4>
<div class="paragraph">
<p>Neo4j-Migrations provides the interface <code>ac.simons.neo4j.migrations.core.JavaBasedMigration</code> for you to implement.
Based on that interface you can do much more than just migrate things via adding or changing data:
You can refactor everything in your database in a programmatic way.
One possible migration looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. Example for a Java-based refactoring</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">some.migrations</span>;

<span class="keyword">import</span> <span class="include">ac.simons.neo4j.migrations.core.JavaBasedMigration</span>;
<span class="keyword">import</span> <span class="include">ac.simons.neo4j.migrations.core.MigrationContext</span>;

<span class="keyword">import</span> <span class="include">org.neo4j.driver.Driver</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.Session</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">V001__MyFirstMigration</span> <span class="directive">implements</span> JavaBasedMigration {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(MigrationContext context) {
        <span class="keyword">try</span> (Session session = context.getSession()) { <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="comment">// Steps necessary for a migration</span>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>MigrationContext</code> provides both <code>getSession()</code> or <code>getSessionConfig()</code> to be used in combination with <code>getDriver()</code>.
The latter is helpful when you want to have access to a reactive or asynchronous session.
It is important that you use the convenient method <code>getSession()</code> or create a session with the provided config as only
those guarantee hat your database session will be connected to the configured target database with the configured user.
In addition, our context will take care of managing Neo4j causal cluster bookmarks.
However, if you feel like it is necessary to switch to a different database, you can use the driver instance any way you want.
The transaction handling inside Java-based migrations is completely up to you.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You don&#8217;t have to annotate your Java-based migrations in any way.
Neo4j-Migrations will find them on the classpath as is.
The same naming requirements that apply to Cypher scripts apply to Java-based migrations as well, see <a href="#concepts_naming-conventions">Section 3.4</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are some restrictions when it comes to run Neo4j-Migrations on GraalVM native image:
      You might or might not be able to convince the runtime to find implementations of an interface in native image.
      You must at least explicitly include those classes in the native image unless used otherwise as well.
     <br>
      The CLI will outright refuse to scan for Java-based migrations in its native form (when using the <code>--package</code> option).
      It does support them only in JVM mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While you can theoretically extend the public base interface <code>Migration</code> too, we don&#8217;t recommend it.
In fact, on JDK 17 we forbid it.
Please use only <code>JavaBasedMigration</code> as the base interface for your programmatic migrations.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="concepts_callbacks"><a class="anchor" href="#concepts_callbacks"></a>3.3. Callbacks</h3>
<div class="paragraph">
<p>Callbacks are part of a refactoring or a chain of migration that lives outside the chain of things.
As such these callbacks can be used to make sure certain data, constructs or other preconditions are available or fulfilled before anything else happens.
They also come in handy during integration tests.
You might want to have your migrations as part of the main source tree of your application and
at the same time have in your tests source tree the same folder with a bunch of callbacks that
create test data for example in an <code>afterMigrate</code> event.</p>
</div>
<div class="paragraph">
<p>Callbacks are not considered immutable after they have been invoked and their invocation is not stored in the history graph.
This gives you a hook to add some more volatile things to your refactoring.</p>
</div>
<div class="paragraph">
<p>The <code>beforeFirstUse</code> callback is especially handy in cases in which you want to create the target database before migrations
are applied: It will always be invoked inside the home database of the connected user, so at this point, the target database
does not need to exist yet.</p>
</div>
<div class="sect3">
<h4 id="concepts_lifecycle-phases"><a class="anchor" href="#concepts_lifecycle-phases"></a>3.3.1. Lifecycle phases</h4>
<div class="paragraph">
<p>The following phases are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">beforeFirstUse</dt>
<dd>
<p>The only phase that only runs once for any given instance of Neo4j-Migrations.
It will run before any other operations are called, when the first connection is opened.
Callbacks in this phase will always be invoked in the schema database and not the target database,
so they won&#8217;t require the target database to be present.
Also, no user impersonation will be performed.
This can be used to create the target database before any migrations or validations are run.</p>
</dd>
<dt class="hdlist1">beforeMigrate</dt>
<dd>
<p>Before migrating a database.</p>
</dd>
<dt class="hdlist1">afterMigrate</dt>
<dd>
<p>After migrating a database, independent of outcome.</p>
</dd>
<dt class="hdlist1">beforeClean</dt>
<dd>
<p>Before cleaning a database.</p>
</dd>
<dt class="hdlist1">afterClean</dt>
<dd>
<p>After cleaning a database, independent of outcome.</p>
</dd>
<dt class="hdlist1">beforeValidate</dt>
<dd>
<p>Before validating a database.</p>
</dd>
<dt class="hdlist1">afterValidate</dt>
<dd>
<p>After validating a database, independent of outcome.</p>
</dd>
<dt class="hdlist1">beforeInfo</dt>
<dd>
<p>Before getting information about the target database.</p>
</dd>
<dt class="hdlist1">afterInfo</dt>
<dd>
<p>After getting information about the target database.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="concepts_naming-conventions"><a class="anchor" href="#concepts_naming-conventions"></a>3.4. Naming conventions</h3>
<div class="sect3">
<h4 id="cypher-basedresources"><a class="anchor" href="#cypher-basedresources"></a>3.4.1. Cypher-based resources</h4>
<div class="paragraph">
<p>All Cypher-based resources (especially migration and callback scripts) require <code>.cypher</code> as extension.
The Core API, the Spring-Boot-Starter and the Maven-Plugin will by default search for such Cypher scripts in <code>classpath:neo4j/migrations</code>.
The CLI has no default search-location.</p>
</div>
<div class="sect4">
<h5 id="concepts_naming-conventions_migration_scripts"><a class="anchor" href="#concepts_naming-conventions_migration_scripts"></a>Migration scripts</h5>
<div class="paragraph">
<p>A Cypher script based migration must have a name following the given pattern to be recognized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">V1_2_3__Add_last_name_index.cypher</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Prefix <code>V</code> for "<em>V</em>ersioned Migrations"</p>
</li>
<li>
<p>Version with optional underscores separating as many parts as you like</p>
</li>
<li>
<p>Separator: <code>__</code> (two underscores)</p>
</li>
<li>
<p>Required description: Underscores or spaces might be used to separate words</p>
</li>
<li>
<p>Suffix: <code>.cypher</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This applies to both Cypher scripts outside an application (in the file system) and inside an application (as resources).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Cypher-based migrations scripts are considered to be immutable once applied!
We compute their checksums and record it inside the schema database.
If you change a Cypher-based migration after it has been applied, any further application will fail.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="callbackscripts"><a class="anchor" href="#callbackscripts"></a>Callback scripts</h5>
<div class="paragraph">
<p>A Cypher script is recognized as a callback for a given lifecycle if it matches the following pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">nameOfTheLifecyclePhase.cypher
nameOfTheLifecyclePhase__optional_description.cypher</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>nameOfTheLifecyclePhase</code> must match exactly (case-sensitive) the name of one of the supported lifecycle phases (see <a href="#concepts_lifecycle-phases">Section 3.3.1</a>),
followed by an optional description and the suffix <code>.cypher</code>, separated from the name of the phase by two underscores (<code>__</code>).
The description is used to order different callback scripts for the same lifecycle phase.
If you use more than one script in the same lifecycle phase without a description, the order is undefined.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Callback scripts are not considered to be immutable and can change between execution.
If you use DDL statements such as <code>CREATE USER</code> or <code>CREATE DATABASE</code> in them make sure you look for an <code>IF NOT EXITS</code>
option in your desired clause so that these statements become idempotent.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-basedmigrations"><a class="anchor" href="#java-basedmigrations"></a>3.4.2. Java-based migrations</h4>
<div class="paragraph">
<p>For Java (or actually anything that can be compiled to a valid Java class) based migrations, the same naming conventions apply as for
<a href="#concepts_naming-conventions_migration_scripts">Cypher-based scripts</a> apart from the extension.
To stick with the above example, <code>V1_2_3__Add_last_name_index.cypher</code> becomes <code>V1_2_3__Add_last_name_index</code> as simple class name,
or in source form, <code>V1_2_3__Add_last_name_index.java</code>.</p>
</div>
<div class="paragraph">
<p>Our recommendation is to use something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">V1_2_3__AddLastNameIndex</span> <span class="directive">implements</span> JavaBasedMigration {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(MigrationContext context) {
        <span class="comment">// Your thing</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getSource() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Add last name index</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defaults to the simple class name being added to the history chain.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="concepts_chain"><a class="anchor" href="#concepts_chain"></a>3.5. Chain of applied migrations</h3>
<div class="paragraph">
<p>All migrations applied to a target database are stored in the schema database.
The target and the schema database can be the same database.
If you are an enterprise customer managing different databases for different tenants that are however used for the same application,
it makes absolutely sense to use a separate schema database that stores all data related to Neo4j-Migrations.</p>
</div>
<div class="paragraph">
<p>The subgraph will look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/chain-of-migrations.png" alt="chain of migrations">
</div>
</div>
<div class="paragraph">
<p>In case you use a schema database for any database with a different name than the default (which is <code>neo4j</code>) the nodes
labelled <code>__Neo4jMigration</code> will have an additional property name <code>migrationTarget</code> which contains the target graph.</p>
</div>
<div class="paragraph">
<p>The chain of applied migrations is stable, and you can of course query it (for example in <a href="#concepts_callbacks">callbacks</a>),
but you should not modify it in any way or form.
In case you want to get rid of it, please use the <a href="#usage_common_clean"><code>clean</code></a> operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="concepts_separate-databases"><a class="anchor" href="#concepts_separate-databases"></a>3.6. Separate schema databases</h3>
<div class="paragraph">
<p>Since version 1.1.0 you can use a different database for storing information about migrations.
You need to run a Neo4j 4+ Enterprise Edition.
The command line argument and the property, respectively, is <code>schema-database</code> throughout the configuration.
The name given must be a valid Neo4j database name (See <a href="https://neo4j.com/docs/operations-manual/current/manage-databases/configuration/">Administration and configuration</a>).
The database must exist and the user must have write access to it.</p>
</div>
<div class="paragraph">
<p>Valid scenarios are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a schema database for one other database</p>
</li>
<li>
<p>Using a schema database for maintaining multiple migrations of different databases</p>
</li>
<li>
<p>Using pairs of schema databases and target databases</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Neo4j-Migrations will create subgraphs in the schema database identifiable by a <code>migrationTarget</code>-property in the <code>__Neo4jMigration</code>-nodes.
Neo4j-Migrations will <strong>not</strong> record a <code>migrationTarget</code> for the default database (usually <code>neo4j</code>),
so that this feature doesn&#8217;t break compatibility with schemas created before 1.1.0.</p>
</div>
</div>
<div class="sect2">
<h3 id="concepts_transactions"><a class="anchor" href="#concepts_transactions"></a>3.7. Transactions</h3>
<div class="paragraph">
<p>All operations executed directly by Neo4j-Migrations are executed inside transactional functions.
This is essentially a scope around one or more statements which will be retried on certain conditions (for example, on losing connectivity inside a cluster setup).</p>
</div>
<div class="paragraph">
<p>You can configure if all statements of one <a href="#concepts_migrations_cypher-based">Cypher-based</a> migration go into one
transactional function or if each statement goes into its own transactional scope:</p>
</div>
<div class="listingblock">
<div class="title">Listing 10. Choose transaction behaviour</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MigrationsConfig configPerMigration = MigrationsConfig.builder()
    .withTransactionMode(MigrationsConfig.TransactionMode.PER_MIGRATION)
    .build();

<span class="comment">// OR</span>

MigrationsConfig configPerStatement = MigrationsConfig.builder()
    .withTransactionMode(MigrationsConfig.TransactionMode.PER_STATEMENT)
    .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Per Migration is the default, as we think it&#8217;s safer:
Either the whole migration is applied (or failed) or none.
But there are certain scenarios that require a transaction per statement, for example most DDL operations such as creating
databases might not be run together with DML operations in the same transaction.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="anchor" href="#usage"></a>4. Usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="usage_common"><a class="anchor" href="#usage_common"></a>4.1. Common operations</h3>
<div class="sect3">
<h4 id="usage_common_clean"><a class="anchor" href="#usage_common_clean"></a>4.1.1. Clean</h4>
<div class="paragraph">
<p><code>clean</code> applies by default to the schema database.
It will remove Neo4j-Migrations related nodes and relationships.
If there is no schema database selected, it works on the optional target database.
If this isn&#8217;t configured either, the users home database will be used.</p>
</div>
<div class="paragraph">
<p>The clean operation will search for</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Migration chains (those are the nodes containing information about the applied migrations)</p>
</li>
<li>
<p>Any log from this Neo4j-Migrations</p>
</li>
<li>
<p>Any constraints created by Neo4j-Migrations</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and will delete and drop them in that order.
This is a <strong>destructive</strong> operation, so make sure not to apply it to your production database without thinking at least twice.
It cannot be undone via Neo4j-Migrations.</p>
</div>
<div class="paragraph">
<p>The operation takes in a boolean parameter.
When set to <code>false</code>, only the <a href="#concepts_chain">migration chain</a> for the currently configured target database will be deleted.
When set to <code>true</code>, all objects created by Neo4j-Migrations will be deleted.</p>
</div>
</div>
<div class="sect3">
<h4 id="usage_common_info"><a class="anchor" href="#usage_common_info"></a>4.1.2. Info</h4>
<div class="paragraph">
<p>The <code>info</code> operations returns information about the context, the database, all applied and all pending applications.</p>
</div>
</div>
<div class="sect3">
<h4 id="usage_common_migrate"><a class="anchor" href="#usage_common_migrate"></a>4.1.3. Migrate / apply</h4>
<div class="paragraph">
<p>The <code>migrate</code> command (or its underlying method <code>apply</code> in the Migrations Core API) does exactly that:
It applies all locally resolved migrations to the target database and stores the <a href="#concepts_chain">chain of applied migrations</a> in the schema database.</p>
</div>
<div class="paragraph">
<p>It returns the last applied version.</p>
</div>
</div>
<div class="sect3">
<h4 id="usage_common_validate"><a class="anchor" href="#usage_common_validate"></a>4.1.4. Validate</h4>
<div class="paragraph">
<p>The <code>validate</code> operations resolves all local migrations and checks whether all have applied in the same order and in the
same version to the configured database.
A target database will validate as valid when all migrations have been applied in the right order and invalid in any cases
where migrations are missing, have not been applied, applied in a different order or with a different checksum.</p>
</div>
<div class="paragraph">
<p>The validation result provides an additional operation <code>needsRepair()</code>.
In case the result is invalid you might check if it needs repair.
If not, you can just call the <a href="#usage_common_migrate">apply operation</a> to turn the database into a valid state.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cli"><a class="anchor" href="#cli"></a>4.2. CLI</h3>
<div class="paragraph">
<p>Please choose the version of Neo4j-Migrations-CLI fitting your operating system or target system as described in <a href="#download_cli">Section 2.1</a>.
In the following we assume you downloaded and unzipped the architecture independent version.
For that version to work, you need to have JDK 8 or higher installed:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. Download and extraction of the JVM based version</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">java -version
curl -LO https://github.com/michael-simons/neo4j-migrations/releases/download/1.4.0-SNAPSHOT/neo4j-migrations-1.4.0-SNAPSHOT.zip
unzip neo4j-migrations-1.4.0-SNAPSHOT.zip
cd neo4j-migrations-1.4.0-SNAPSHOT
./bin/neo4j-migrations -V</code></pre>
</div>
</div>
<div class="paragraph">
<p>Those commands should first print out your Java version, then download, extract and run Neo4j-Migrations-CLI to give you its version.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you only deal with <a href="#concepts_migrations_cypher-based">Cypher-based migrations</a> and
      don&#8217;t have the need for any <a href="#concepts_migrations_java-based">programmatic migrations</a>,
      we provide a native binary for your platform, make sure to choose that.
      Its startup time is faster, and you don&#8217;t need to have a JVM installed.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="alloptionsandarguments"><a class="anchor" href="#alloptionsandarguments"></a>4.2.1. All options and arguments</h4>
<div class="paragraph">
<p>The CLI comes with a build-in help, accessible via <code>neo4j-migrations -h</code> or <code>neo4j-migrations --help</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">./bin/neo4j-migrations --help
Usage: neo4j-migrations [-hvV] [--autocrlf] [--validate-on-migrate] -p
                        [=&lt;password&gt;] [-p[=&lt;password&gt;]]... [-a=&lt;address&gt;]
                        [-d=&lt;database&gt;] [--impersonate=&lt;impersonatedUser&gt;]
                        [--schema-database=&lt;schemaDatabase&gt;]
                        [--transaction-mode=&lt;transactionMode&gt;] [-u=&lt;user&gt;]
                        [--location=&lt;locationsToScan&gt;]...
                        [--package=&lt;packagesToScan&gt;]... [COMMAND]
Migrates Neo4j databases.
  -a, --address=&lt;address&gt;   The address this migration should connect to. The
                              driver supports bolt, bolt+routing or neo4j as
                              schemes.
      --autocrlf            Automatically convert Windows line-endings (CRLF)
                              to LF when reading resource based migrations,
                              pretty much what the same Git option does during
                              checkin.
  -d, --database=&lt;database&gt; The database that should be migrated (Neo4j EE 4.0
                              +).
  -h, --help                Show this help message and exit.
      --impersonate=&lt;impersonatedUser&gt;
                            The name of a user to impersonate during migration
                              (Neo4j EE 4.4+).
      --location=&lt;locationsToScan&gt;
                            Location to scan. Repeat for multiple locations.
  -p, --password[=&lt;password&gt;]
                            The password of the user connecting to the database.
      --package=&lt;packagesToScan&gt;
                            Package to scan. Repeat for multiple packages.
      --schema-database=&lt;schemaDatabase&gt;
                            The database that should be used for storing
                              information about migrations (Neo4j EE 4.0+).
      --transaction-mode=&lt;transactionMode&gt;
                            The transaction mode to use.
  -u, --username=&lt;user&gt;     The login of the user connecting to the database.
  -v                        Log the configuration and a couple of other things.
  -V, --version             Print version information and exit.
      --validate-on-migrate Validating helps you verify that the migrations
                              applied to the database match the ones available
                              locally and is on by default.
Commands:
  clean           Removes Neo4j-Migration specific data from the selected
                    schema database
  help            Displays help information about the specified command
  info            Retrieves all applied and pending informations, prints them
                    and exits.
  migrate, apply  Retrieves all pending migrations, verify and applies them.
  validate        Resolves all local migrations and validates the state of the
                    configured database with them.</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="safepasswordsincicdusage"><a class="anchor" href="#safepasswordsincicdusage"></a>4.2.2. Safe passwords in CI/CD usage</h4>
<div class="paragraph">
<p>There are 4 ways to specify the password:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>interactive: Use <code>--password</code> without arguments and your shell will prompt you with a hidden prompt.</p>
</li>
<li>
<p>direct: Use <code>--password not-so-secret</code>. The password will be visible in the shell history and in the process monitor.</p>
</li>
<li>
<p>Via environment variable: Define an environment variable like <code>MY_PASSWORD</code> and use <code>--password:env MY_PASSWORD</code>. Note
that the parameter is the <strong>name</strong>  of the variable, not the resolved value.</p>
</li>
<li>
<p>Via a file: Create a file in a safe space and add your password in a single line in that file and use <code>--password:file path/to/your/passwordFile</code>.
The password will be read from this file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The last two options are a safe choice in scripts or in a CI/CD environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="enableautocompletionforneo4j-migrationsinyourshell"><a class="anchor" href="#enableautocompletionforneo4j-migrationsinyourshell"></a>4.2.3. Enable autocompletion for Neo4j-Migrations in your shell</h4>
<div class="paragraph">
<p>Neo4j-Migrations can generate a shell script providing autocompletion for its options in Bash, zsh and others.
Here&#8217;s how to use it:</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. Generate autocompletion script</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">./bin/neo4j-migrations generate-completion &gt; neo4j-migrations_completion.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated script <code>neo4j-migrations_completion.sh</code> can than be run via <code>. neo4j-migrations_completion.sh</code> or permanently installed by
sourcing it in your <code>~/.bashrc</code> or <code>~/.zshrc</code>.</p>
</div>
<div class="paragraph">
<p>If you want to have autocompletion for Neo4j-Migrations just in your current shell use the following command</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. Add autocompletion to your current shell</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">source &lt;(./bin/neo4j-migrations generate-completion)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Autocompletion for macOS is automatically installed when you use <a href="#download_cli_brew">Homebrew</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="fullexample"><a class="anchor" href="#fullexample"></a>4.2.4. Full example</h4>
<div class="paragraph">
<p>Here&#8217;s an example that looks for migrations in a Java package, its subpackages and in a filesystem location for Cypher-based migrations.
In this example we have exported the directory with our Java-based migrations like this: <code>export CLASSPATH_PREFIX=~/Projects/neo4j-migrations/neo4j-migrations-core/target/test-classes/</code>.
Please adapt accordingly to your project and / or needs.</p>
</div>
<div class="paragraph">
<p>The example uses the <code>info</code> command to tell you which migrations have been applied and which not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">./bin/neo4j-migrations -uneo4j -psecret \
  --location file:$HOME/Desktop/foo \
  --package ac.simons.neo4j.migrations.core.test_migrations.changeset1 \
  --package ac.simons.neo4j.migrations.core.test_migrations.changeset2 \
  info

neo4j@localhost:7687 (Neo4j/4.4.0)
Database: neo4j

+---------+-----------------------------+--------+--------------+----+----------------+---------+--------------------------------------------------------------+
| Version | Description                 | Type   | Installed on | by | Execution time | State   | Source                                                       |
+---------+-----------------------------+--------+--------------+----+----------------+---------+--------------------------------------------------------------+
| 001     | FirstMigration              | JAVA   |              |    |                | PENDING | a.s.n.m.c.t.changeset1.V001__FirstMigration                  |
| 002     | AnotherMigration            | JAVA   |              |    |                | PENDING | a.s.n.m.c.t.changeset1.V002__AnotherMigration                |
| 023     | NichtsIstWieEsScheint       | JAVA   |              |    |                | PENDING | a.s.n.m.c.t.changeset2.V023__NichtsIstWieEsScheint           |
| 023.1   | NichtsIstWieEsScheintNeu    | JAVA   |              |    |                | PENDING | a.s.n.m.c.t.changeset2.V023_1__NichtsIstWieEsScheintNeu      |
| 023.1.1 | NichtsIstWieEsScheintNeuNeu | JAVA   |              |    |                | PENDING | a.s.n.m.c.t.changeset2.V023_1_1__NichtsIstWieEsScheintNeuNeu |
| 030     | Something based on a script | CYPHER |              |    |                | PENDING | V030__Something_based_on_a_script.cypher                     |
| 042     | The truth                   | CYPHER |              |    |                | PENDING | V042__The truth.cypher                                       |
+---------+-----------------------------+--------+--------------+----+----------------+---------+--------------------------------------------------------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can repeat both <code>--package</code>  and <code>--location</code> parameter for fine-grained control.
Use <code>migrate</code> to apply migrations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">./bin/neo4j-migrations -uneo4j -psecret \
  --location file:$HOME/Desktop/foo \
  --package ac.simons.neo4j.migrations.core.test_migrations.changeset1 \
  --package ac.simons.neo4j.migrations.core.test_migrations.changeset2 \
  migrate
Applied migration 001 (&quot;FirstMigration&quot;)
Applied migration 002 (&quot;AnotherMigration&quot;)
Applied migration 023 (&quot;NichtsIstWieEsScheint&quot;)
Applied migration 023.1 (&quot;NichtsIstWieEsScheintNeu&quot;)
Applied migration 023.1.1 (&quot;NichtsIstWieEsScheintNeuNeu&quot;)
Applied migration 030 (&quot;Something based on a script&quot;)
Applied migration 042 (&quot;The truth&quot;)
Database migrated to version 042.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we go back to the <code>info</code> example above and grab all migrations again, we find the following result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">./bin/neo4j-migrations -uneo4j -psecret \
  --location file:$HOME/Desktop/foo \
  --package ac.simons.neo4j.migrations.core.test_migrations.changeset1 \
  --package ac.simons.neo4j.migrations.core.test_migrations.changeset2 \
  info

Database: Neo4j/4.0.0@localhost:7687

+---------+-----------------------------+--------+-------------------------------+---------------+----------------+---------+--------------------------------------------------------------+
| Version | Description                 | Type   | Installed on                  | by            | Execution time | State   | Source                                                       |
+---------+-----------------------------+--------+-------------------------------+---------------+----------------+---------+--------------------------------------------------------------+
| 001     | FirstMigration              | JAVA   | 2021-12-14T12:16:43.577Z[UTC] | msimons/neo4j | PT0S           | APPLIED | a.s.n.m.c.t.changeset1.V001__FirstMigration                  |
| 002     | AnotherMigration            | JAVA   | 2021-12-14T12:16:43.876Z[UTC] | msimons/neo4j | PT0.032S       | APPLIED | a.s.n.m.c.t.changeset1.V002__AnotherMigration                |
| 023     | NichtsIstWieEsScheint       | JAVA   | 2021-12-14T12:16:43.993Z[UTC] | msimons/neo4j | PT0S           | APPLIED | a.s.n.m.c.t.changeset2.V023__NichtsIstWieEsScheint           |
| 023.1   | NichtsIstWieEsScheintNeu    | JAVA   | 2021-12-14T12:16:44.014Z[UTC] | msimons/neo4j | PT0S           | APPLIED | a.s.n.m.c.t.changeset2.V023_1__NichtsIstWieEsScheintNeu      |
| 023.1.1 | NichtsIstWieEsScheintNeuNeu | JAVA   | 2021-12-14T12:16:44.035Z[UTC] | msimons/neo4j | PT0S           | APPLIED | a.s.n.m.c.t.changeset2.V023_1_1__NichtsIstWieEsScheintNeuNeu |
| 030     | Something based on a script | CYPHER | 2021-12-14T12:16:44.093Z[UTC] | msimons/neo4j | PT0.033S       | APPLIED | V030__Something_based_on_a_script.cypher                     |
| 042     | The truth                   | CYPHER | 2021-12-14T12:16:44.127Z[UTC] | msimons/neo4j | PT0.011S       | APPLIED | V042__The truth.cypher                                       |
+---------+-----------------------------+--------+-------------------------------+---------------+----------------+---------+--------------------------------------------------------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another <code>migrate</code> - this time with all packages - gives us the following output and result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">./bin/neo4j-migrations -uneo4j -psecret \
  --location file:$HOME/Desktop/foo \
  --package ac.simons.neo4j.migrations.core.test_migrations.changeset1 \
  --package ac.simons.neo4j.migrations.core.test_migrations.changeset2 \
  migrate
Skipping already applied migration 001 (&quot;FirstMigration&quot;)
Skipping already applied migration 002 (&quot;AnotherMigration&quot;)
Skipping already applied migration 023 (&quot;NichtsIstWieEsScheint&quot;)
Skipping already applied migration 023.1 (&quot;NichtsIstWieEsScheintNeu&quot;)
Skipping already applied migration 023.1.1 (&quot;NichtsIstWieEsScheintNeuNeu&quot;)
Skipping already applied migration 030 (&quot;Something based on a script&quot;)
Skipping already applied migration 042 (&quot;The truth&quot;)
Database migrated to version 042.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The database will be now in a valid state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">./bin/neo4j-migrations -uneo4j -psecret \
  --location file:$HOME/Desktop/foo \
  --package ac.simons.neo4j.migrations.core.test_migrations.changeset1 \
  --package ac.simons.neo4j.migrations.core.test_migrations.changeset2 \
  validate
All resolved migrations have been applied to the default database.</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="atemplateforjava-basedmigrations"><a class="anchor" href="#atemplateforjava-basedmigrations"></a>4.2.5. A template for Java-based migrations</h4>
<div class="paragraph">
<p>As stated above, this will work only with the JVM distribution.
Follow those steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wget https://github.com/michael-simons/neo4j-migrations/releases/download/1.4.0-SNAPSHOT/neo4j-migrations-1.4.0-SNAPSHOT.zip
unzip neo4j-migrations-1.4.0-SNAPSHOT.zip
cd neo4j-migrations-1.4.0-SNAPSHOT
mkdir -p my-migrations/some/migrations
cat &lt;&lt;EOT &gt;&gt; my-migrations/some/migrations/V001__MyFirstMigration.java
package some.migrations;

import ac.simons.neo4j.migrations.core.JavaBasedMigration;
import ac.simons.neo4j.migrations.core.MigrationContext;

import org.neo4j.driver.Driver;
import org.neo4j.driver.Session;

public class V001__MyFirstMigration implements JavaBasedMigration {

    @Override
    public void apply(MigrationContext context) {
        try (Session session = context.getSession()) {
        }
    }
}
EOT
javac -cp &quot;lib/*&quot; my-migrations/some/migrations/*
CLASSPATH_PREFIX=my-migrations ./bin/neo4j-migrations -v -uneo4j -psecret --package some.migrations info</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We do add this here for completeness, but we do think that Java-based migrations makes most sense from inside your application,
      regardless whether it&#8217;s a Spring Boot, Quarkus or just a plain Java application.
      The CLI should be seen primarily as a script runner.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="coreapi"><a class="anchor" href="#coreapi"></a>4.3. Core API</h3>
<div class="paragraph">
<p>We publish the Java-API-Docs here: <a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations/apidocs/index.html">Neo4j Migrations (Core) 1.4.0-SNAPSHOT API</a>.
Follow the instructions for your favorite dependency management tool to get hold of the core API as described in <a href="#download_core">Section 2.2</a>.</p>
</div>
<div class="paragraph">
<p>The classes you will be working with are <code>ac.simons.neo4j.migrations.core.MigrationsConfig</code> and its related builder and
<code>ac.simons.neo4j.migrations.core.Migrations</code> and maybe <code>ac.simons.neo4j.migrations.core.JavaBasedMigration</code> in case you
want to do programmatic refactorings.</p>
</div>
<div class="sect3">
<h4 id="configurationandusage"><a class="anchor" href="#configurationandusage"></a>4.3.1. Configuration and usage</h4>
<div class="paragraph">
<p>Configuration is basically made up of two parts:
Creating a driver instance that points to your database or cluster as described in <a href="#concepts_connectivity">Section 3.1</a> and an instance of <code>MigrationsConfig</code>.
An instance of <code>MigrationsConfig</code> is created via a fluent-builder API.
Putting everything together looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. Creating an instance of <code>Migrations</code> based on a configuration object and the Java driver</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Migrations migrations = <span class="keyword">new</span> Migrations(
    MigrationsConfig.builder()
        .withPackagesToScan(<span class="string"><span class="delimiter">&quot;</span><span class="content">some.migrations</span><span class="delimiter">&quot;</span></span>)
        .withLocationsToScan(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:my/awesome/migrations</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">file:/path/to/migration</span><span class="delimiter">&quot;</span></span>
        )
        .build(),
    GraphDatabase.driver(<span class="string"><span class="delimiter">&quot;</span><span class="content">bolt://localhost:7687</span><span class="delimiter">&quot;</span></span>, AuthTokens.basic(<span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>))
);

migrations.apply(); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Applies this migration object and migrates the database</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case anything goes wrong the API will throw a <code>ac.simons.neo4j.migrations.core.MigrationsException</code>.
Of course your migrations will be recorded as a chain of applied migrations (as nodes with the label <code>__Neo4jMigration</code>) as well when you use the API directly.</p>
</div>
</div>
<div class="sect3">
<h4 id="runningonthejavamodule-path"><a class="anchor" href="#runningonthejavamodule-path"></a>4.3.2. Running on the Java module-path</h4>
<div class="paragraph">
<p>Neo4j-Migrations can be used on the Java module path. Make sure you require them in your module and export packages with Java-based migrations in case you&#8217;re using the latter.
Resoruces on the classpath should be picked up automatically:</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. Using Neo4j-Migrations on the module path</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module my.module {
    requires ac.simons.neo4j.migrations.core;

    exports my.module.java_based_migrations; <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Only needed when you actually have those</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="usage_spring-boot-starter"><a class="anchor" href="#usage_spring-boot-starter"></a>4.4. Spring-Boot-Starter</h3>
<div class="paragraph">
<p>We provide a starter with automatic configuration for <a href="https://start.spring.io">Spring Boot</a>.
Declare the following dependency in your Spring Boot application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>eu.michael-simons.neo4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>neo4j-migrations-spring-boot-starter<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.4.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or follow the instructions for Gradle in <a href="#download_springboot">Section 2.3</a>.</p>
</div>
<div class="paragraph">
<p>That starter itself depends on the <a href="https://github.com/neo4j/neo4j-java-driver">Neo4j Java Driver</a>.
The driver is managed by Spring Boot since 2.4, and you can enjoy configuration support directly through Spring Boot.
For Spring Boot versions prior to Spring Boot 2.4, please have a look at version <a href="https://github.com/michael-simons/neo4j-migrations/tree/0.0.13">0.0.13</a> of this library.</p>
</div>
<div class="paragraph">
<p>Neo4j-Migrations will automatically look for migrations in <code>classpath:neo4j/migrations</code> and will fail if this location does not exist.
It does not scan by default for Java-based migrations.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example on how to configure the driver and the migrations:</p>
</div>
<div class="listingblock">
<div class="title">Listing 16. Configure both the driver, disable the existence check for migration scripts and scan for Java-based migration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">spring.neo4j.authentication.username=neo4j
spring.neo4j.authentication.password=secret
spring.neo4j.uri=bolt://localhost:7687

# Add configuration for your migrations, for example, additional packages to scan
org.neo4j.migrations.packages-to-scan=your.changesets, another.changeset

# Or disable the check if the location exists
org.neo4j.migrations.check-location=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Have a look at <a href="#usage_spring-boot_all-properties">Section 4.4.2</a> for all supported properties.</p>
</div>
<div class="sect3">
<h4 id="usagewithdataneo4jtest"><a class="anchor" href="#usagewithdataneo4jtest"></a>4.4.1. Usage with <code>@DataNeo4jTest</code></h4>
<div class="paragraph">
<p>If you want to use your migrations together with <code>@DataNeo4jTest</code> which is provided with Spring Boot out of the box,
you have to manually import our autoconfiguration like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">ac.simons.neo4j.migrations.springframework.boot.autoconfigure.MigrationsAutoConfiguration</span>;

<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.driver.Driver</span>;

<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Autowired</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.autoconfigure.ImportAutoConfiguration</span>;
<span class="keyword">import</span> <span class="include">org.springframework.boot.test.autoconfigure.data.neo4j.DataNeo4jTest</span>;

<span class="keyword">import</span> <span class="include">org.springframework.test.context.DynamicPropertyRegistry</span>;
<span class="keyword">import</span> <span class="include">org.springframework.test.context.DynamicPropertySource</span>;
<span class="keyword">import</span> <span class="include">org.testcontainers.containers.Neo4jContainer</span>;
<span class="keyword">import</span> <span class="include">org.testcontainers.junit.jupiter.Container</span>;
<span class="keyword">import</span> <span class="include">org.testcontainers.junit.jupiter.Testcontainers</span>;
<span class="keyword">import</span> <span class="include">org.testcontainers.utility.TestcontainersConfiguration</span>;

<span class="annotation">@Testcontainers</span>(disabledWithoutDocker = <span class="predefined-constant">true</span>)
<span class="annotation">@DataNeo4jTest</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@ImportAutoConfiguration</span>(MigrationsAutoConfiguration.class) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">UsingDataNeo4jTest</span> {

    <span class="annotation">@Container</span>
    <span class="directive">private</span> <span class="directive">static</span> Neo4jContainer&lt;?&gt; neo4j = <span class="keyword">new</span> Neo4jContainer&lt;&gt;(<span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j:4.2</span><span class="delimiter">&quot;</span></span>)
        .withReuse(TestcontainersConfiguration.getInstance().environmentSupportsReuse()); <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="annotation">@DynamicPropertySource</span>
    <span class="directive">static</span> <span class="type">void</span> neo4jProperties(DynamicPropertyRegistry registry) { <i class="conum" data-value="4"></i><b>(4)</b>

        registry.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">spring.neo4j.uri</span><span class="delimiter">&quot;</span></span>, neo4j::getBoltUrl);
        registry.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">spring.neo4j.authentication.username</span><span class="delimiter">&quot;</span></span>, () -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>);
        registry.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">spring.neo4j.authentication.password</span><span class="delimiter">&quot;</span></span>, neo4j::getAdminPassword);
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> yourTest(<span class="annotation">@Autowired</span> <span class="predefined-type">Driver</span> driver) {
        <span class="comment">// Whatever is tested</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the dedicated Neo4j test slice</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Import <em>this</em> auto-configuration (which is not part of Spring Boot)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Bring up a container to test against</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use <code>DynamicPropertySource</code>  for configuring the test resources dynamically</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="usage_spring-boot_all-properties"><a class="anchor" href="#usage_spring-boot_all-properties"></a>4.4.2. Available configuration properties</h4>
<div class="paragraph">
<p>The following configuration properties in the <code>org.neo4j.migrations</code> namespace are supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.check-location</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether to check that migration scripts location exists.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.database</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The database that should be migrated (Neo4j EE 4.0+ only). Leave {@literal null} for using the default database.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.schema-database</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The database that should be used for storing information about migrations (Neo4j EE 4.0+ only). Leave {@literal null} for using the default database.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.impersonated-user</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An alternative user to impersonate during migration. Might have higher privileges than the user connected, which  will be dropped again after migration. Requires Neo4j EE 4.4+. Leave {@literal null} for using the connected user.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.enabled</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Whether to enable Neo4j-Migrations or not.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.encoding</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.nio.charset.Charset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UTF-8</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Encoding of Cypher migrations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.installed-by</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>System user</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Username recorded as property {@literal by} on the MIGRATED_TO relationship.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.locations-to-scan</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>classpath:neo4j/migrations</code></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Locations of migrations scripts.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.packages-to-scan</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>An empty array</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>List of packages to scan for Java migrations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.transaction-mode</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>PER_MIGRATION</code></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The transaction mode in use (Defaults to "per migration", meaning one script is run in one transaction).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.validate-on-migrate</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>true</code></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Validating helps you verify that the migrations applied to the database match the ones available locally and is on by default.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>org.neo4j.migrations.autocrlf</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>false</code></code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Automatically convert Windows line-endings (CRLF) to LF when reading resource based migrations, pretty much what the same Git option does during checkin.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Migrations can be disabled by setting <code>org.neo4j.migrations.enabled</code> to <code>false</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="usage_quarkus"><a class="anchor" href="#usage_quarkus"></a>4.5. Quarkus</h3>
<div class="paragraph">
<p>We provide an extension with automatic configuration for Quarkus.
Declare the following dependency in your Quarkus application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>eu.michael-simons.neo4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>neo4j-migrations-quarkus<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.4.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That extension itself depends on the <a href="https://github.com/neo4j/neo4j-java-driver">Neo4j Java Driver</a> and the corresponding
Quarkus extension <a href="https://github.com/quarkiverse/quarkus-neo4j">Quarkus-Neo4j</a> and requires at least Quarkus 2.6.
You don&#8217;t need to declare those dependencies, they are already transitive dependencies of this extension.</p>
</div>
<div class="paragraph">
<p>Neo4j-Migrations will automatically look for migrations in <code>classpath:neo4j/migrations</code> and will fail if this location does not exist.
It does not scan by default for Java-based migrations.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example on how to configure the driver and the migrations:</p>
</div>
<div class="listingblock">
<div class="title">Listing 17. Configure both the driver and scan for Java-based migrations, too</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">quarkus.neo4j.uri=bolt://localhost:7687
quarkus.neo4j.authentication.username=neo4j
quarkus.neo4j.authentication.password=secret

org.neo4j.migrations.packages-to-scan=foo.bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you disable Neo4j-Migrations via <code>org.neo4j.migrations.enabled</code> we won&#8217;t apply Migrations at startup but the <code>Migrations</code> object
will still be in the context to be used.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
All other properties available for the <a href="#usage_spring-boot_all-properties">Spring-Boot-Starter</a> are available for the Quarkus extension, too.
Their namespace is the same: <code>org.neo4j.migrations</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="build-timevsruntimeconfig"><a class="anchor" href="#build-timevsruntimeconfig"></a>4.5.1. Build-time vs runtime config</h4>
<div class="paragraph">
<p><code>org.neo4j.migrations.packages-to-scan</code> and <code>org.neo4j.migrations.locations-to-scan</code> are build-time configuration options
and cannot be changed during runtime. This allows for optimized images to be created: All migrations that are part of the
classpath (both scripts and class based migrations) are discovered during  image build-time already and are included in
the image themselves (this applies to both native and JVM images).</p>
</div>
<div class="paragraph">
<p>While scripts in file system locations (all locations starting with <code>file://</code>) are still discovered during runtime and thus
allows for scripts being added without recreating the application image, the location cannot be dynamically changed. If you
need a dynamic, <code>file://</code> based location, use <code>org.neo4j.migrations.external-locations</code>. This property is changeable during
runtime and allows for one image being used in different deployments pointing to different external locations with scripts
outside the classpath</p>
</div>
<div class="paragraph">
<p>An alternative approach to that is using the CLI in a sidecar container, pointing to the dynamic location and keep applying
database migrations outside the application itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="devservicesintegration"><a class="anchor" href="#devservicesintegration"></a>4.5.2. Dev Services integration</h4>
<div class="paragraph">
<p>Neo4j-Migrations will appear as a tile in the Quarkus Dev UI under <a href="http://localhost:8080/q/dev/" class="bare">http://localhost:8080/q/dev/</a>.
It provides a <a href="http://localhost:8080/q/dev/eu.michael-simons.neo4j.neo4j-migrations-quarkus/migrations">list of migrations</a>
which can be used to clean the database or apply all migrations.
The latter is handy when migrate at start is disabled or in case there are callbacks that might reset or recreate testdata.</p>
</div>
<video controls>
  <source src="videos/quarkus-dev-ui.webm" type="video/webm">
</video>
</div>
</div>
<div class="sect2">
<h3 id="usage_maven-plugin"><a class="anchor" href="#usage_maven-plugin"></a>4.6. Maven-Plugin</h3>
<div class="paragraph">
<p>You can trigger Neo4j-Migrations from your build a Maven-Plugin.
Please refer to the dedicated <a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations-maven-plugin/plugin-info.html">Maven-Plugin page</a> for
a detailed list of all goals and configuration option as well as the default lifecycle mapping of the plugin.</p>
</div>
<div class="sect3">
<h4 id="configuration"><a class="anchor" href="#configuration"></a>4.6.1. Configuration</h4>
<div class="paragraph">
<p>Most of the time you will configure the following properties for the plugin:</p>
</div>
<div class="listingblock">
<div class="title">Listing 18. Configuring the Maven-Plugin</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>eu.michael-simons.neo4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>neo4j-migrations-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.4.0-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;executions&gt;</span>
        <span class="tag">&lt;execution&gt;</span>
            <span class="tag">&lt;configuration&gt;</span>
                <span class="tag">&lt;user&gt;</span>neo4j<span class="tag">&lt;/user&gt;</span>
                <span class="tag">&lt;password&gt;</span>secret<span class="tag">&lt;/password&gt;</span>
                <span class="tag">&lt;address&gt;</span>bolt://localhost:${it-database-port}<span class="tag">&lt;/address&gt;</span>
                <span class="tag">&lt;verbose&gt;</span>true<span class="tag">&lt;/verbose&gt;</span>
            <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;/execution&gt;</span>
    <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All goals provide those properties.
By default, the plugin will look in <code>neo4j/migrations</code> for <a href="#concepts_migrations_cypher-based">Cypher-based migrations</a>.
You can change that via <code>locationsToScan</code> inside the <code>configuration</code> element like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 19. Changing the locations to scan for the Maven-Plugin</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;locationsToScan&gt;</span>
    <span class="tag">&lt;locationToScan&gt;</span>file://${project.build.outputDirectory}/custom/path<span class="tag">&lt;/locationToScan&gt;</span>
<span class="tag">&lt;/locationsToScan&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add multiple <code>locationToScan</code> elements for multiple locations to scan.</p>
</div>
</div>
<div class="sect3">
<h4 id="goals"><a class="anchor" href="#goals"></a>4.6.2. Goals</h4>
<div class="paragraph">
<p>All goals as described in <a href="#usage_common">Section 4.1</a> are supported.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations-maven-plugin/clean-mojo.html">clean</a>, see <a href="#usage_common_clean">Section 4.1.1</a></p>
</li>
<li>
<p><a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations-maven-plugin/help-mojo.html">help</a></p>
</li>
<li>
<p><a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations-maven-plugin/info-mojo.html">info</a>, see <a href="#usage_common_info">Section 4.1.2</a></p>
</li>
<li>
<p><a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations-maven-plugin/migrate-mojo.html">migrate</a>, see <a href="#usage_common_migrate">Section 4.1.3</a></p>
</li>
<li>
<p><a href="https://michael-simons.github.io/neo4j-migrations/main/site/neo4j-migrations-maven-plugin/validate-mojo.html">clean</a>, see <a href="#usage_common_validate">Section 4.1.4</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above list links to the corresponding Maven-Plugin page, please check those goals out for further details.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="#appendix"></a>Appendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="glossary"><a class="anchor" href="#glossary"></a>Glossary</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Pending migration</dt>
<dd>
<p>See <em>Resolved migration</em>.</p>
</dd>
<dt class="hdlist1">Resolved migration</dt>
<dd>
<p>A migration that has been resolved in the classpath or the filesystem which has not been yet applied.</p>
</dd>
<dt class="hdlist1">Schema database</dt>
<dd>
<p>A database inside a Neo4j enterprise instance or cluster that stores the schema information from Neo4j-Migrations.</p>
</dd>
<dt class="hdlist1">Target database</dt>
<dd>
<p>A database inside a Neo4j enterprise instance or cluster that is refactored by Neo4j-Migrations.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-02-21 11:17:08 UTC
</div>
</div>
</body>
</html>